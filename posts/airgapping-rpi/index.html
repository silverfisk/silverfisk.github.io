<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Tom"><meta name=description content="https://linux-konsult.com"><meta name=keywords content="blog,devops,sustainability,esp8266,prometheus,grafana"><meta property="og:site_name" content="linux-konsult.com"><meta property="og:title" content="
  Airgap your Raspberry Pi on a shoestring budget - linux-konsult.com
"><meta property="og:description" content="Airgap install a Raspberry Pi with a cheap ESP-01 Programmer"><meta property="og:type" content="website"><meta property="og:url" content="https://linux-konsult.com/posts/airgapping-rpi/"><meta property="og:image" content="https://linux-konsult.com/img/rpi-logo.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://linux-konsult.com/posts/airgapping-rpi/"><meta name=twitter:image content="https://linux-konsult.com/img/rpi-logo.png"><base href=https://linux-konsult.com/posts/airgapping-rpi/><title>Airgap your Raspberry Pi on a shoestring budget - linux-konsult.com</title><link rel=canonical href=https://linux-konsult.com/posts/airgapping-rpi/><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://linux-konsult.com/index.xml type=application/rss+xml title=linux-konsult.com><link href=https://linux-konsult.com/index.xml rel=feed type=application/rss+xml title=linux-konsult.com><meta name=generator content="Hugo 0.113.0"></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>linux-konsult.com</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-center"><a class=navigation-link href=https://linux-konsult.com/posts>Blog</a></li><li class="navigation-item align-center"><a class=navigation-link href=https://linux-konsult.com/categories>Topics</a></li><li class="navigation-item align-center"><a class=navigation-link href=https://linux-konsult.com/links>Links</a></li><li class="navigation-item align-center"><a class=navigation-link href=http://whoami.linux-konsult.com>Resume</a></li></ul></label></section></nav><div class=content><section class="container post"><article><header><h1 class=title>Airgap your Raspberry Pi on a shoestring budget</h1><h2 class=date>May 5, 2022</h2></header><p>Airgapping is a method used when you want to be reasonable sure your device wasn&rsquo;t tampered with.
Regardless if you want to install a <a href=https://github.com/SeedSigner/seedsigner/blob/dev/docs/manual_installation.md>Seedsigner</a> or something else. The best is to never have had it connected to your network in the first place.</p><p>Here&rsquo;s how I used a $1 USB serial programmer for an ESP-01 to configure an off-line Raspberry Pi. I&rsquo;ll also show how to transfer files to your machine with this oldschool method.</p><div class=portfolio><div class=portfolio-inner><div class=portfolio-image><img src=/img/esp01-usb-programmer.jpg alt="ESP01 Programmer"></div><div class=portfolio-content><p>Most attackers (unless &ldquo;stuxnet-level&rdquo;) use the IP protocol to interfer with their victims.
Another vector is to interfer with the USB cables used to communicate with a device.</p><p>With this method, no TCP/IP nor USB devices was ever connected. This makes verification of all steps much easier.</p><p>Furthermore, the computer draws power from the GPIO pin so there is no need to power it from the USB port.</p></div></div></div><div class=portfolio><div class=portfolio-inner><div class=portfolio-image><img src=/img/esp01-usb-serialcables.jpeg alt=Programmer></div><div class=portfolio-content><p>This is what you need to configure your raspberry pi:</p><ul><li>A USB Serial programmer (I got mine for a dollar from AliExpress)</li><li>Four Jumper wires</li><li>A linux computer with the <em>screen</em> tool installed</li></ul></div></div></div><h2 id=set-up>Set up</h2><p>Connect a jumper wire in each one of the four pins (TX, GND, 3V+ & RX).<div class=portfolio><div class=portfolio-inner><div class=portfolio-image><img src=/img/ESP01-pins.png alt="Programmer Pins"></div><div class=portfolio-content></div></div></div></p><p>Each one should go to the GPIO header with the same marking on the Raspberry PI:<div class=portfolio><div class=portfolio-inner><div class=portfolio-image><img src=/img/connections-rpi.jpg alt=Connections></div><div class=portfolio-content></div></div></div></p><h3 id=preparation-of-the-raspberry-pi>Preparation of the Raspberry Pi</h3><p>Flash the Raspberry Pi image onto the SD card. Re-mount the SD card and edit <code>config.txt</code>. The last line should say:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>enable_uart=1
</span></span></code></pre></div><p>Now generate a password in userconf.txt (or use something else if you prefer). You will use the my_user and my_pw to create a user & password on the RPi. Take note of these as you&rsquo;ll need it to log on to the RPi later.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl> $ <span class=nb>export</span> <span class=nv>my_user</span><span class=o>=</span><span class=s2>&#34;pi&#34;</span>
</span></span><span class=line><span class=cl> $ <span class=nb>export</span> <span class=nv>my_pw</span><span class=o>=</span><span class=k>$(</span>&lt; /dev/urandom tr -dc _A-Z-a-z-0-9 <span class=p>|</span> head -c<span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>16</span><span class=si>}</span><span class=p>;</span><span class=nb>echo</span><span class=k>)</span>
</span></span><span class=line><span class=cl> $ <span class=nb>export</span> <span class=nv>my_hash</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=nv>$my_pw</span> <span class=p>|</span>openssl passwd -6 -stdin<span class=k>)</span>
</span></span><span class=line><span class=cl> $ <span class=nb>echo</span> <span class=si>${</span><span class=nv>my_user</span><span class=si>}</span>:<span class=si>${</span><span class=nv>my_hash</span><span class=si>}</span> &gt; userconf.txt
</span></span></code></pre></div><p>Copy the userconf.txt to the same boot partition as the config.txt file.</p><ul><li>Put the SD card in the RPi</li><li>Connect the USB serial interface to your computer. It will power up your RPi directly.</li></ul><h2 id=connect-the-console>Connect the console</h2><p>Open a terminal on your computer</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo usermod -a -G dialout <span class=k>$(</span>whoami<span class=k>)</span>    <span class=c1># Give yourself access to the serial device</span>
</span></span><span class=line><span class=cl>newgrp
</span></span><span class=line><span class=cl>screen /dev/ttyUSB0 <span class=m>115200</span>
</span></span></code></pre></div><h2 id=copy-files-over-serial-connection>Copy files over serial connection</h2><p>All files you want to copy have to be base64 encoded on your desktop. To copy myfile:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>base64 myfile &gt; myfile.b64
</span></span></code></pre></div><ol><li>Open the screen session <code>screen /dev/ttyUSB0 115200</code></li><li>Type <em>Ctrl-A</em> then <code>:readreg p /path/to/myfile.b64</code></li><li>Then, still in screen, on the target RPi:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>base64 -d &gt; myfile
</span></span></code></pre></div><ol start=4><li>Type <em>Ctrl-D</em></li></ol></article><br></section></div><footer class=footer><section class=container><div class="sns-shares sp-sns-shares"><a class="sns-share linkedIn-share" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2flinux-konsult.com%2fposts%2fairgapping-rpi%2f"><i class="fab fa-linkedin"></i></a></div></section></footer><div class=fixed-bar><section class=container><p id=privateTriggerText>Contact details <a id=privateTrigger>Click!</a></p><div class="sns-shares pc-sns-shares"><a class="sns-share linkedIn-share" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2flinux-konsult.com%2fposts%2fairgapping-rpi%2f"><i class="fab fa-linkedin"></i></a></div></section></div></main><script src=/js/app.js></script>
<script>(function(e){e(function(){e("#privateTrigger").on("click",function(){e(".private").slideToggle(),e("#privateTriggerText").text("tom@linux-konsult.com")})})})(jQuery)</script></body></html>